import React, { ReactElement, useRef } from 'react';
import { Button, View } from 'react-native';
import { PlotlyWebView, PlotlyWebViewHandle } from '@sea-birdscientific/typescript-data-visualization/dist'
import { lowPassFilter } from '@sea-birdscientific/typescript-data-processing/lib/DataProcessing'


const temperature = [20.97688381,20.97639022,20.97614344,20.97614344,20.97564986,20.97532082,20.97490952,20.97433371,20.9735934,20.97326438,20.97285311,20.97260635,20.97235959,20.97170158,20.97112583,20.97063234,20.97046785,20.97005662,20.96956314,20.96915192,20.96857622,20.96841174,20.96906968,20.96767158,20.96339543,20.95961319,20.95648909,20.95443394,20.95336532,20.95402293,20.9555026,20.95665351,20.95755783,20.95911989,20.96183314,20.96454664,20.96734262,20.96972763,20.97227734,20.97482726,20.97680154,20.97836461,20.9800923,20.98149099,20.98297201,20.98437083,20.98601658,20.9879093,20.99013135,20.99218895,20.99432899,20.99704543,20.99992677,21.00354942,21.00774894,21.01178433,21.01549078,21.01977435,21.02438812,21.02941464,21.03435958,21.03773909,21.04062434,21.04334497,21.04746761,21.05365263,21.059179,21.06421135,21.06726417,21.06973966,21.07452619,21.0815423,21.08781693,21.09632279,21.10573986,21.11482931,21.12441754,21.13342996,21.1411216,21.15038727,21.15849708,21.16652631,21.17356399,21.17927815,21.18598747,21.19153829,21.19767024,21.20629024,21.2159907,21.22586021,21.23465427,21.24569199,21.25748111,21.26620141,21.27367797,21.28157192,21.2915462,21.29977749,21.30534944,21.31058969,21.31641326,21.32165544,21.32681531,21.3323923,21.34196717,21.3512952,21.35770991,21.36304267,21.36954325,21.37737916,21.38755223,21.39747848,21.40423689,21.41049603,21.4171739,21.42535632,21.43370804,21.44381673,21.45334376,21.46320826,21.47157056,21.47709096,21.48144108,21.4866286,21.49181701,21.49633669,21.5024477,21.51224468,21.52078826,21.52254753,21.52497718,21.53302155,21.54224173,21.54878139,21.55230334,21.55213562,21.55624507,21.56639531,21.57545793,21.58217277,21.59124019,21.60173832,21.61358465,21.62778964,21.64275842,21.6605962,21.67886573,21.69554539,21.71265594,21.73095738,21.7495233,21.76700271,21.78601369,21.80402193,21.82119484,21.83863166,21.85709533,21.87395977,21.88990078,21.90585032,21.92265748,21.94074851,21.9578304,21.97441176,21.99006623,22.00411121,22.01637406,22.02651176,22.03341419,22.03827241,22.03946578,22.03767575,22.03332896,22.02625615,22.01560749,22.00240843,21.98725803,21.97109475,21.95383525,21.93556639,21.91662958,21.89719579,21.87811379,21.85997601,21.84167992,21.82364892,21.80495223,21.78685891,21.76826973,21.7495233,21.72986066,21.71096973,21.6927648,21.67608669,21.66068037,21.64713274,21.63544128,21.62518349,21.61677809,21.61047559,21.60543455,21.60157032,21.59930243,21.59737065,21.59695072,21.59728666,21.59905045,21.60182232,21.60518252,21.60946731,21.61434096,21.61997186,21.62652857,21.63384352,21.6420855,21.651087,21.6603437,21.67002424,21.68105546,21.69259629,21.70431016,21.71569134,21.72690817,21.73770729,21.74851032,21.75855727,21.76852314,21.77756287,21.78601369,21.79387511,21.8014849,21.80808163,21.81417221,21.81958711,21.82449521,21.82889626,21.833044,21.83659966,21.83947837,21.84210331,21.84413569,21.84549068,21.84642227,21.84709981,21.84693043,21.84625289,21.84515192,21.844051,21.84235735,21.84057912,21.838801,21.83668432,21.83448314,21.83245143,21.83058914,21.82855769,21.82686492,21.82517225,21.82280267,21.8200948,21.81755641,21.81493362,21.81231107,21.8100271,21.8082508,21.80664376,21.80554425,21.80461394,21.80351451,21.80258426,21.80156947,21.80089296,21.80038559,21.80038559,21.80106209,21.80190773,21.80317623,21.80478308,21.80689749,21.80918123,21.81154973,21.81408761,21.81679493,21.81924865,21.82212568,21.82466447,21.82711883,21.83008127,21.83270538,21.83516041,21.83753098,21.83947837,21.84167992,21.84396632,21.84591413,21.84760798,21.84930193,21.85074186,21.85167362,21.85285953,21.85353722,21.85413021,21.85480792,21.85506207,21.85506207,21.85497735,21.85480792,21.85472321,21.85421492,21.8533678,21.85277482,21.85184303,21.85099597,21.85031834,21.84972543,21.84887843,21.84828555,21.84760798,21.84684573,21.84659166,21.84633758,21.84625289,21.84608351,21.84633758,21.84667635,21.84693043,21.84752328,21.84820085,21.84904783,21.84981013,21.85082656,21.85175832,21.85294424,21.85379135,21.85472321,21.85565509,21.85684116,21.85777311,21.85853564,21.85946764,21.8604844,21.86124699,21.86217908,21.8631112,21.86370437,21.86438231,21.86480603,21.86506026,21.86531449,21.86556873,21.86590772,21.86573822,21.86582297,21.86556873,21.86539924,21.865145,21.86497551,21.86472128,21.86421282,21.86387386,21.86387386,21.86353489,21.86345015,21.86353489,21.86328067,21.8631112,21.8631112,21.8631112,21.8631112,21.86328067,21.86361963,21.8639586,21.86412808,21.86438231,21.86480603,21.86522975,21.86573822,21.86590772,21.8665857,21.86717895,21.86768746,21.86819597,21.8687045,21.86921303,21.86963682,21.86989109,21.87039965,21.87065393,21.87082345,21.87124726,21.87124726,21.87150154,21.87175583,21.8718406,21.87192536,21.87209489,21.87209489,21.87201013,21.87201013,21.87167107,21.87158631,21.87124726,21.87090821,21.87065393,21.87031489,21.86997585,21.86980633,21.86938255,21.86921303,21.86895877,21.86887401,21.86853499,21.86836548,21.86811122,21.86802647,21.86768746,21.86717895,21.8667552,21.8664162,21.86607721,21.86590772,21.86582297,21.86522975,21.86489077,21.86455179,21.86455179,21.86446705,21.86404334,21.8639586,21.86328067,21.86302646,21.8626875,21.86243329,21.8617554,21.86099279,21.86014548,21.8596371,21.859044,21.85811201,21.85768839,21.85692589,21.85641756,21.85599396,21.85540094,21.85472321,21.85396078,21.85277482,21.85192774,21.85133479,21.85006423,21.84921723,21.84803146,21.84709981,21.84625289,21.8453213,21.84472849,21.84388163,21.8430348,21.84218799,21.84167992,21.84134121,21.8406638,21.84007108,21.83905501,21.83829298,21.83719231,21.83617635,21.83499109,21.83389054,21.83287469,21.83168957,21.82991198,21.82864233,21.82804985,21.82728811,21.82652638,21.82601857,21.82568004,21.82534151,21.82457984,21.82331042,21.82170257,21.81967172,21.81789485,21.81637189,21.81535664,21.81408761,21.81290324,21.81129595,21.80994251,21.80867372,21.80748956,21.80622087,21.80427565,21.8030071,21.80258426,21.8030071,21.80283796,21.80140034,21.79886353,21.79649604,21.79581965,21.79548146,21.79497418,21.79286062,21.7907472,21.78956375,21.78804225,21.78652082,21.78567562,21.7846614,21.7834782,21.78204151,21.78060489,21.77899934,21.77781636,21.77663343,21.77485912,21.77300042,21.77131081,21.76936786,21.76801633,21.76708718,21.76582021,21.76480667,21.76328643,21.761344,21.7595706,21.75796618,21.75619298,21.75425102,21.75239362,21.75095843,21.74986097,21.74791943,21.74648445,21.74496514,21.74302392,21.74167357,21.73998573,21.73880429,21.73787605,21.73661032,21.73492276,21.7338259,21.73239161,21.73011375,21.72749864,21.72488377,21.7228595,21.7213414,21.72058237,21.71948604,21.71763079,21.71585999,21.7141736,21.71265594,21.71139127,21.71012667,21.7081034,21.70574311,21.70338299,21.70127591,21.6990847,21.69613524,21.69318608,21.69091122,21.68863652,21.68669895,21.68535116,21.68391919,21.68223461,21.68080279,21.67894995,21.67743407,21.67549723,21.67330792,21.67036101,21.66707766,21.66514149,21.66371049,21.66236373,21.66017537,21.65857629,21.65731392,21.65537839,21.65319054,21.65100286,21.64856294,21.64629147,21.64393606,21.64216962,21.64073972,21.63956221,21.63779603,21.63560947,21.63417989,21.63317081,21.63182543,21.62989154,21.62804186,21.62501535,21.62156887,21.61837493,21.6157696,21.61299643,21.61047559,21.60820701,21.60610664,21.60400641,21.60199032,21.60073034,21.59921843,21.5970347,21.59501909,21.59241579,21.58998066,21.5873778,21.58385171,21.58074574,21.57831155,21.5759615,21.57419907,21.57226892,21.57033889,21.56748603,21.56371061,21.56018731,21.55792256,21.55590958,21.55339356,21.55163246,21.54936835,21.54643365,21.54366692,21.54173873,21.53914008,21.5362902,21.53251871,21.52933428,21.52606639,21.52355288,21.52112335,21.51877778,21.51676745,21.51525978,21.51417096,21.51207718,21.50830876,21.50361982,21.49960132,21.49709003,21.49499745,21.4910638,21.48704698,21.48395106,21.48177574,21.48035349,21.47801113,21.47458156,21.47182147,21.46931251,21.46805811,21.46630204,21.46320826,21.45877719,21.45501548,21.45217361,21.45016775,21.44757704,21.44456876,21.44139368,21.43888727,21.43554573,21.43161989,21.42811213];
const pressure = [3.019225303,3.059358481,3.133445956,3.212158197,3.2939626,3.358779122,3.392728103,3.397352895,3.394266136,3.422041631,3.43284529,3.357225034,3.420508931,3.670536558,3.925194658,4.198363227,4.456103653,4.818800221,5.203099879,5.604382819,6.027274199,6.556656488,7.160133743,7.765151354,8.345471425,9.004517291,9.628066364,10.20530977,10.73933862,11.19928373,11.57434044,11.88920772,12.14850699,12.36921187,12.5652387,12.73347089,12.8785598,13.02056187,13.19188554,13.40488689,13.65493147,13.9312111,14.23990388,14.57174918,14.94681617,15.37127104,15.83430609,16.31278864,16.80670712,17.29754346,17.78836991,18.29617976,18.77312092,19.22691067,19.64674432,20.03879903,20.37991851,20.70405655,21.00349883,21.26743739,21.52211525,21.77988684,22.03457167,22.29234383,22.56245838,22.84492164,23.13819911,23.45462698,23.79728962,24.13995009,24.51503427,24.91326677,25.32076695,25.75450566,26.20522712,26.67910038,27.17303866,27.67315505,28.16401127,28.65486874,29.09787638,29.51773346,29.86658411,30.16758406,30.40375571,30.59516126,30.74334842,30.86529453,31.00267253,31.14313991,31.32528659,31.55065222,31.83158783,32.18198419,32.58795307,33.06338539,33.58975825,34.15780698,34.75364455,35.32941839,35.91291356,36.4639925,36.97648058,37.3963512,37.78843831,38.11723406,38.36885104,38.56643916,38.72697965,38.87208367,39.01101316,39.180816,39.37686127,39.63465438,39.9541945,40.30769493,40.70287351,41.12892905,41.56270308,42.00882826,42.46730258,42.91034175,43.34566293,43.78561676,44.19315341,44.58988544,44.975812,45.34475913,45.69518161,46.03016791,46.37441721,46.71094865,47.03358718,47.36240108,47.66034092,47.92895043,48.17594783,48.3982457,48.60510684,48.80888029,49.00956683,49.20407819,49.42483361,49.67492048,49.94970704,50.27080707,50.63050149,51.02724719,51.46104357,51.91954171,52.38730304,52.82573383,53.26107877,53.67944245,54.07928082,54.43280638,54.75391297,55.06730292,55.3729745,55.65703249,55.94417955,56.21280151,56.47370378,56.7099044,56.92758194,57.13290692,57.33205928,57.54047477,57.77204386,58.02523043,58.33399478,58.6983358,59.11362363,59.59838453,60.15261744,60.7053096,61.28270648,61.8508368,62.36493569,62.81111011,63.21714157,63.55061445,63.80998264,63.98598067,64.10177432,64.17278788,64.2005774,64.23454648,64.28395217,64.37966964,64.53251224,64.74711176,65.04044673,65.38010052,65.75835415,66.14432347,66.54573475,66.93324955,67.30532625,67.66350613,67.98617959,68.30577098,68.62381652,68.94031608,69.28769152,69.66441004,70.08126551,70.50738535,70.93196221,71.34418864,71.71781179,72.06519487,72.36934238,72.63953001,72.8757515,73.0826417,73.28335643,73.49178788,73.73109834,74.01981193,74.36256724,74.73929338,75.16542677,75.64405566,76.18598104,76.71710732,77.23897138,77.70679419,78.14837437,78.53591642,78.84625634,79.10718929,79.28783539,79.39591433,79.4530378,79.4638457,79.46230172,79.47002165,79.50552933,79.58581661,79.71397556,79.8977102,80.13239671,80.43038313,80.76388597,81.13136156,81.52971798,81.94196706,82.39126889,82.85446776,83.33157716,83.83493636,84.35064009,84.88024146,85.41293233,85.94253659,86.44434467,86.90446962,87.3105639,87.68422409,87.98840761,88.22928025,88.42691445,88.59367276,88.72955,88.86388328,89.00284366,89.1587888,89.34407647,89.57105411,89.84589287,90.16705407,90.50829402,90.87732256,91.2849537,91.7157523,92.15890455,92.5927877,93.04366799,93.45902384,93.87130374,94.26042307,94.62483758,94.95373836,95.23012815,95.43395091,95.63314751,95.79837981,95.94507089,96.08712973,96.19367392,96.3094829,96.45154809,96.62140152,96.81904934,97.05531286,97.32399108,97.6343612,97.96326143,98.33694851,98.74459471,99.17077783,99.64328628,100.1281557,100.651617,101.1519306,101.6661363,102.1525484,102.6343292,103.0713301,103.4897879,103.8711931,104.1923829,104.445615,104.6479033,104.8054103,104.9366734,105.0524876,105.1667505,105.3211767,105.5342753,105.8060463,106.1473138,106.5426362,107.0321413,107.5309201,108.063688,108.5671098,109.0272873,109.447316,109.7978476,110.1051491,110.3445048,110.5174511,110.6409976,110.7274747,110.8108712,110.9004369,111.039434,111.2154693,111.4486574,111.7420555,112.0678911,112.4385104,112.8322861,113.2461542,113.6523019,114.0291013,114.3750162,114.6730595,114.9556605,115.1996551,115.4143089,115.6320514,115.85133,116.0922372,116.3547646,116.6404737,116.9524104,117.2844233,117.6303613,117.982451,118.339183,118.691274,119.0140237,119.3182601,119.6147577,119.8788341,120.1413486,120.40697,120.6633258,120.9212354,121.1822159,121.4509182,121.7520699,122.0547756,122.3744419,122.7003045,123.0277027,123.3720986,123.7149414,124.0500536,124.3759192,124.7033108,125.0075567,125.2979041,125.5542762,125.7998091,126.0376496,126.2785694,126.5009475,126.7233453,126.9457237,127.1696468,127.3889468,127.6144147,127.8414469,128.049957,128.2445281,128.4576618,128.6723402,128.9055314,129.1773423,129.4738638,129.7935414,130.1688276,130.588902,131.0583979,131.5495269,132.023648,132.4700022,132.8839039,133.2530186,133.5912456,133.8615293,134.0792819,134.2460794,134.3650106,134.463843,134.5564977,134.6692407,134.8128831,135.0013032,135.245323,135.5418537,135.8723625,136.2430273,136.6214149,136.995181,137.348859,137.6855487,138.0006278,138.2848184,138.5504648,138.7929446,139.0138137,139.2362388,139.4694415,139.7073005,139.9636707,140.2324084,140.5042469,140.7868856,141.0757142,141.3830655,141.6965835,141.9807567,142.2479527,142.4966152,142.7159209,142.9337177,143.1345018,143.3321971,143.5268154,143.7445777,143.9932421,144.2820759,144.6002438,144.9462133,145.3107055,145.6999227,146.0922418,146.4737502,146.8660465,147.2212872,147.545638,147.8359973,148.0800333,148.3008892,148.5001218,148.7024561,148.9048031,149.1086698,149.3171704,149.5364703,149.768152,150.016824,150.2855754,150.5589481,150.835423,151.1211657,151.3991987,151.6833977,151.9598614,152.2286283,152.4896729,152.7445266,153.0101927,153.2820505,153.5523511,153.8164868,154.0667349,154.2999667,154.5347301,154.7417045,154.942514,155.1232175,155.2885019,155.4444922,155.6066743,155.7873784,156.0005458,156.2553908,156.5457619,156.8716592,157.2578101,157.684108,158.1305002,158.6016074,159.0804388,159.5206695,159.9377044,160.3300537,160.65906,160.9417139,161.1672446,161.3665167,161.531779,161.686257,161.8237301,161.9751332,162.1373349,162.3211335,162.5281303,162.765992,163.0332308,163.3127843,163.6047527,163.9044018,164.2117747,164.5176177,164.8250059,165.1153887,165.3888096,165.654493,165.909364,166.148774,166.3835649,166.5998492,166.8130004,167.0261813,167.2455116,167.4741399,167.7042983,167.9499188,168.1908907,168.4395863,168.7021696,168.9663129,169.2289118,169.4837725,169.7247462,169.9611012,170.2051499,170.4430048,170.6746962,170.9280139,171.1906153,171.4578664,171.73743,172.0216738,172.3151559,172.6117431,172.9021672,173.1971952,173.4876048,173.7749254,174.0406201,174.2908678,174.5272443,174.7620608,175.0014806,175.2579242,175.5158973,175.8001315,176.1044479,176.4056911,176.694545,176.9602756,177.1981531,177.4067282,177.5813028,177.7311613,177.8578484,177.9736901,178.0941661,178.2362851,178.4000472,178.600884,178.8418529,179.1214578,179.4350483,179.7780065,180.1549507,180.513309,180.8578305,181.1884001,181.509718,181.7908715,182.0380232,182.2589301,182.4319815,182.5833726,182.7332022,182.8954072,183.0730437,183.2924236,183.5674005,183.8933399,184.2872687,184.7306496,185.215708,185.7085087,186.1982039,186.6369376,187.0123338,187.3120162,187.5607018,187.7244555,187.8233602,187.8635263,187.8697056,187.8604366,187.8573469,187.9083441,188.0195733,188.198776,188.4258866,188.6730632,188.9372337,189.1998247,189.4778821,189.742071,189.9815425,190.2147997,190.4326085,190.6550521,190.8914174,191.1324,191.3780174,191.6483531,191.9233415,192.2199586,192.5181033,192.8270982,193.1221718,193.4079765,193.6830033,193.9425097,194.2066871,194.4662301,194.7412224,195.0255027,195.3282861,195.6589328,195.9833823,196.3217367,196.6569836,196.9690389,197.2765151,197.5623076,197.8280719,198.0752975,198.2962041,198.5016801,198.6979053,198.8925858,199.0980625,199.3097005,199.5368442,199.7701118,200.015758,200.2598595,200.4993266,200.7434287,200.9844602];


const data: any = [{
    x: temperature,
    y: pressure,
    type: 'scatter'
}];

let processedData: any = data.map((x: any) => ({...x}))


const layout: any = {
    title: 'Temperature vs Pressure',
    xaxis: {
        title: 'tv290C',
        showgrid: false,
        zeroline: false
    },
    yaxis: {
        title: 'prdM',
        showline: false,
        autorange: 'reversed'
    },
    width: 800,
    height: 500
};


const App = (): ReactElement => {
    const plotlyWebViewRef = useRef<PlotlyWebViewHandle>(null)

    const createPlot = (data: any, layout?: any, config?: any) => {
        if (plotlyWebViewRef && plotlyWebViewRef.current){
            plotlyWebViewRef.current.createPlot(data, layout);
        }
    }

    const filterTemperature = (data: any, layout?: any, config?: any) => {
        const timeConstant = 100;
        const sampleInterval = 10;
        data[0].x = lowPassFilter(data[0].x, timeConstant, sampleInterval);

        if (plotlyWebViewRef && plotlyWebViewRef.current){
            plotlyWebViewRef.current.updatePlot(data, layout);
        }
    }

    return (
        <View style={{flex: 1}}>
        <View style={{flexDirection: 'row', alignItems: 'stretch'}}>
            <Button
                onPress={() => {createPlot(data, layout)}}
                title="Create Plot"
            />
            <Button
                onPress={() => {filterTemperature(processedData, layout)}}
                title="Filter Temperature"
            />
        </View>
        <View style={{flex: 1}}>
            <PlotlyWebView
                ref={plotlyWebViewRef}
                data={data}
                layout={layout}
            />
        </View>
    </View>

    );
}

export default App;

